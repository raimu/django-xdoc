{% extends 'xdoc/base.html' %}

{% block css_area %}
<style>
#id_parent { display: none; }
</style>
{% endblock %}

{% block javacscipt_area %}
{{ form.media }}
<script src="{{ STATIC_URL }}xdoc/lib/jquery.cookie.js"></script>
<script src="{{ STATIC_URL }}xdoc/lib/jstree-v.pre1.0/jquery.jstree.js"></script>
<script src="{{ STATIC_URL }}xdoc/lib/jeresig-jquery.hotkeys/jquery.hotkeys.js"></script>

<script type="text/javascript">
    $(document).ready(function(){
        $("#tree").jstree({
            "json_data" : {
                "ajax" : {
                    "url" : "{% url 'tree' %}",
                    "data" : function (n) {
                        return { id : n.attr ? n.attr("id") : 0 };
                    }
                }
            },
            "core": {
                "animation": 100{% if initially_open %},
                initially_open: {{ initially_open|safe }}{% endif %}
            },
            "themes" : {
                "theme" : "apple"
            },
            "ui": {
                'select_limit': 1
            },
            "plugins" : [ "themes", "json_data", 'ui', 'hotkeys' ]
        })
        .bind("select_node.jstree", function (event, data) {
            $('#id_parent').val(data.rslt.obj.attr("id"));
        })
        .bind("loaded.jstree", function (event, data) {
            {% if selected_parent %}
                $.jstree._focused().select_node("#{{ selected_parent }}");
            {% endif %}
        })
        .bind("open_node.jstree", function (event, data) {
            {% if selected_parent %}
                $.jstree._focused().select_node("#{{ selected_parent }}");
            {% endif %}
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="container" style="padding-bottom: 50px">
    <form action="{{ url }}" method="post">{% csrf_token %}
        {{ form.as_p }}
        <div id="tree"></div>
        <div class="navbar navbar-fixed-bottom">
            <div class="navbar-inner">
                <input type="submit" value="Save" class="btn btn-large btn-primary" />
            </div>
        </div>
    </form>
</div>
{% endblock %}